<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meine Firebase App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
    </style>
</head>
<body class="p-8 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl">
        <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">Hallo Firebase!</h1>

        <!-- Nachrichtenbereich für Echtzeit-Updates -->
        <div id="messages" class="border border-gray-200 rounded-lg p-4 mb-4 h-64 overflow-y-auto bg-gray-50">
            <!-- Nachrichten werden hier dynamisch eingefügt -->
        </div>

        <!-- Formular zum Senden einer Nachricht -->
        <form id="messageForm" class="flex items-center space-x-2">
            <input type="text" id="messageInput" placeholder="Gib deine Nachricht ein..."
                   class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-300 ease-in-out">
            <button type="submit"
                    class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 ease-in-out">
                Senden
            </button>
        </form>

        <!-- Lade- und Fehleranzeige -->
        <p id="status" class="mt-4 text-center text-gray-500 text-sm"></p>
        
        <!-- UI für Fehlermeldungen (anstelle von alert) -->
        <div id="error-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4">
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl shadow-lg w-full max-w-sm" role="alert">
                <div class="flex items-center">
                    <svg class="w-6 h-6 mr-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                    </svg>
                    <p class="font-bold text-lg">Fehler!</p>
                </div>
                <p id="error-message" class="text-sm mt-2"></p>
                <div class="mt-4 flex justify-end">
                    <button id="close-error-modal" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl focus:outline-none focus:shadow-outline">
                        Schließen
                    </button>
                </div>
            </div>
        </div>

    </div>
const firebaseConfig = {
  apiKey: "AIzaSyACb9R0oXXhquYdN8tYtMMy4v0mMH-hqUA",
  authDomain: "parkplatzverwaltung-m6.firebaseapp.com",
  projectId: "parkplatzverwaltung-m6",
  storageBucket: "parkplatzverwaltung-m6.firebasestorage.app",
  messagingSenderId: "342485827923",
  appId: "1:342485827923:web:831feba65c0f8d06f9a1a6"
};
    <script type="module">
        // Firebase-Bibliotheken importieren
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Globale Variablen
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Hilfsfunktion zum Anzeigen von Fehlern in der UI
        function showError(message) {
            const errorModal = document.getElementById('error-modal');
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
            errorModal.classList.remove('hidden');
        }

        // Hilfsfunktion zum Schließen des Fehlermodals
        document.getElementById('close-error-modal').addEventListener('click', () => {
            document.getElementById('error-modal').classList.add('hidden');
        });

        // App-Status anzeigen
        function setStatus(message) {
            document.getElementById('status').textContent = message;
        }

        let db, auth;
        let userId;

        // Hauptinitialisierungsfunktion
        async function initializeAppAndAuth() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    showError("Firebase-Konfiguration fehlt. Bitte fügen Sie Ihr Konfigurationsobjekt ein.");
                    return;
                }

                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Benutzer authentifizieren
                setStatus("Authentifizierung...");
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        setStatus(`Angemeldet als: ${userId}`);
                        setupRealtimeListener();
                    } else {
                        setStatus("Nicht angemeldet.");
                        userId = null;
                    }
                });

            } catch (error) {
                console.error("Fehler bei der Initialisierung:", error);
                showError("Fehler bei der Initialisierung. Überprüfen Sie die Konsole für Details.");
            }
        }

        // Firestore-Listener einrichten
        function setupRealtimeListener() {
            if (!db || !userId) {
                console.error("Datenbank oder Benutzer-ID nicht verfügbar.");
                return;
            }
            
            // Verwenden Sie eine public collection path für gemeinschaftliche Daten
            const collectionPath = `/artifacts/${appId}/public/data/messages`;
            const q = query(collection(db, collectionPath));
            
            // onSnapshot hört auf Echtzeit-Änderungen
            onSnapshot(q, (snapshot) => {
                const messagesContainer = document.getElementById('messages');
                messagesContainer.innerHTML = '';
                
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const messageElement = document.createElement('div');
                    messageElement.className = 'p-2 my-1 rounded-md bg-gray-100 border border-gray-200';
                    messageElement.textContent = `${data.sender}: ${data.text}`;
                    messagesContainer.appendChild(messageElement);
                });
                
                // Zum neuesten Element scrollen
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, (error) => {
                console.error("Fehler beim Abrufen von Nachrichten:", error);
                showError("Fehler beim Abrufen von Echtzeit-Nachrichten.");
            });
        }

        // Formular-Handler für das Senden von Nachrichten
        document.getElementById('messageForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const messageInput = document.getElementById('messageInput');
            const messageText = messageInput.value.trim();

            if (messageText === "" || !userId) {
                showError("Nachricht kann nicht leer sein oder der Benutzer ist nicht angemeldet.");
                return;
            }

            try {
                setStatus("Sende Nachricht...");
                const collectionPath = `/artifacts/${appId}/public/data/messages`;
                await addDoc(collection(db, collectionPath), {
                    sender: `User-${userId.substring(0, 4)}`,
                    text: messageText,
                    timestamp: new Date()
                });
                messageInput.value = ''; // Eingabefeld leeren
                setStatus("Nachricht gesendet!");
            } catch (error) {
                console.error("Fehler beim Senden der Nachricht:", error);
                showError("Fehler beim Senden der Nachricht.");
            }
        });

        initializeAppAndAuth();
    </script>
</body>
</html>
